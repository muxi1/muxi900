<html>
  <head>
    <meta charset="utf-8">
    <title>MUXI900 v3.3</title>
    <script src="./muxi.js"></script>
	<style>
    body{background-color:black;
    color:white;font-size:25px;text-align:center;margin:0;overflow:hidden;}
    </style>
<br><br>
<img class="colelem" id="pic" alt="&nbsp;MUXI900" src="pic.png" data-image-width="852"/>
<br><br><br><br>
    <script>
      if ((window.applicationCache.status == '0') || (window.applicationCache.status == '3')) { // 0: UNCACHED, 3: IDLE
        window.location.replace("cache.html");
      }
    </script>
  </head>
  <body>
        <div>

      <button id="jailbreakBtn">Starte Jailbreak</button>
    </div>
    <div style="margin-top: 15px;">
      <label style="font-size: 16px;">
        <input type="checkbox" id="autoRunCheck" checked>
        Startet automatisch in <span id="countdown">5</span> Sekunden
      </label>
    </div>
    <pre id="console"></pre>
  </body>
  <script>
    // Logging utility
    const outputConsole = document.getElementById("console");
    window.log = (msg, color="#cccccc") => { outputConsole.innerHTML += `<span style="color:${color}">${msg}</span><br>`; };
    // Event definitions
    addEventListener('unhandledrejection', event => {
      const reason = event.reason;
      alert(
        'Unhandled rejection\n'
        + `${reason}\n`
        + `${reason.sourceURL}:${reason.line}:${reason.column}\n`
        + `${reason.stack}`
      );
    });
    addEventListener('error', event => {
      const reason = event.error;
      alert(
        'Unhandled error\n'
        + `${reason}\n`
        + `${reason.sourceURL}:${reason.line}:${reason.column}\n`
        + `${reason.stack}`
      );
      return true; // Used for not to show error message on console
    });
    var autoRunEnabled = true;
    var countdownValue = 5;
    var countdownTimer = null;
    // Button click
    document.getElementById("jailbreakBtn").addEventListener("click", () => {
      // Disable to prevent double click
      document.getElementById("jailbreakBtn").disabled = true;
      document.getElementById("autoRunCheck").disabled = true;
      document.getElementById("autoRunCheck").checked = false;
      document.getElementById("countdown").textContent = "-";
      if (countdownTimer !== null) {
        clearInterval(countdownTimer);
        countdownTimer = null;
      }
      outputConsole.textContent = ""; // Clear console log
      try {
        doJBwithPSFreeLapseExploit();
      } catch (error) {
        window.log("");
      }
    });
    // Autorun system
    var autoRunCheck = document.getElementById('autoRunCheck');
    var countdownSpan = document.getElementById('countdown');
    var jailbreakBtn = document.getElementById('jailbreakBtn');
    // Checkbox control
    autoRunCheck.addEventListener('change', function () {
      autoRunEnabled = autoRunCheck.checked;
      if (!autoRunEnabled) {
        // Cancel countdown
        clearInterval(countdownTimer);
        countdownSpan.textContent = "-";
      } else {
        // Restart countdown
        restartCountdown();
      }
    });
    // Restart countdown
    function restartCountdown() {
      clearInterval(countdownTimer);
      countdownValue = 5;
      countdownSpan.textContent = countdownValue;
      countdownTimer = setInterval(function () {
        if (!autoRunEnabled) {
          clearInterval(countdownTimer);
          return;
        }
        countdownValue--;
        countdownSpan.textContent = countdownValue;
        if (countdownValue <= 0) {
          clearInterval(countdownTimer);
          jailbreakBtn.click();  // Call click function
        }
      }, 1000);
    }
    // Autostart countdown when page refresh
    window.addEventListener('load', function () {
      restartCountdown();
    });
  </script>
</html>
